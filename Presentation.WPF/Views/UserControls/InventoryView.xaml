<UserControl x:Name="Inventory" x:Class="Presentation.WPF.Views.InventoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Presentation.WPF.Views"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>        
            <ColumnDefinition Width="629*"/>
            <ColumnDefinition Width="171*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="105"/>
            <RowDefinition Height="125"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Main Content Grid -->
        <Grid x:Name="MainContent" Grid.RowSpan="3" Grid.ColumnSpan="2" Opacity="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="105"/>
                <RowDefinition Height="125"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Section 1 -->
            <Border Grid.Row="0" Background="#F5F5F5" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header Row -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Inventory" Foreground="Black" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Search and Button Row -->
                    <Grid Grid.Row="1" Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Search Box with Icon -->
                        <Border Background="White" BorderBrush="#E8E8E8" BorderThickness="0.5" CornerRadius="5">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Search Icon -->
                                <TextBlock Grid.Column="0" 
                                       Text="🔍" 
                                       Foreground="#999999" 
                                       FontSize="16" 
                                       Margin="10,0,5,0"
                                       VerticalAlignment="Center"/>

                                <!-- Search TextBox -->
                                <TextBox Grid.Column="1"
                                     BorderThickness="0" 
                                     Background="Transparent"
                                     Padding="5,8"
                                     FontSize="12"
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                            </Grid>
                        </Border>

                        <!-- Button Section -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10,0,0,0" VerticalAlignment="Center">
                            <!-- Refresh Button -->
                            <Button Content="🔄" 
                                Command="{Binding RefreshCommand}"
                                Background="#1976D2"
                                Foreground="White" 
                                Padding="12,8" 
                                FontSize="12"
                                FontWeight="Bold"
                                Cursor="Hand"
                                BorderThickness="0"
                                Margin="0,0,5,0"/>

                            <!-- Add New Item Button -->
                            <Button Content="+ Add New Item" 
                                Command="{Binding AddNewItemCommand}"
                                Background="#1976D2"
                                Foreground="White" 
                                Padding="12,8" 
                                FontSize="12"
                                FontWeight="Bold"
                                Cursor="Hand"
                                BorderThickness="0"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Section 2 -->
            <Border Grid.Row="1" Background="#FFFFFF" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total Items Card -->
                    <Border Grid.Column="0" Background="#E3F2FD" CornerRadius="8" Margin="5" Padding="15">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Total Items" Foreground="#1976D2" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Text="{Binding TotalItems}" Foreground="#1565C0" FontSize="24" FontWeight="Bold" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Low Stock Card -->
                    <Border Grid.Column="1" Background="#FFF3E0" CornerRadius="8" Margin="5" Padding="15">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Low Stock" Foreground="#F57C00" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Text="{Binding LowStockCount}" Foreground="#E65100" FontSize="24" FontWeight="Bold" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Out of Stock Card -->
                    <Border Grid.Column="2" Background="#FFEBEE" CornerRadius="8" Margin="5" Padding="15">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Out of Stock" Foreground="#C62828" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Text="{Binding OutOfStockCount}" Foreground="#B71C1C" FontSize="24" FontWeight="Bold" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Total Value Card -->
                    <Border Grid.Column="3" Background="#E8F5E9" CornerRadius="8" Margin="5" Padding="15">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Total Value" Foreground="#388E3C" FontSize="12" FontWeight="Bold"/>
                            <TextBlock Text="{Binding TotalValue, StringFormat='C'}" Foreground="#2E7D32" FontSize="24" FontWeight="Bold" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Section 3 - DataGrid -->
            <Border Grid.Row="2" Background="#FFFFFF" BorderBrush="#F0F0F0" BorderThickness="0.5" Padding="0">
                <DataGrid ItemsSource="{Binding Products}"
                      SelectedItem="{Binding SelectedProduct}"
                      AutoGenerateColumns="False" 
                      BorderThickness="0"
                      Background="#FFFFFF"
                      Foreground="#333333"
                      GridLinesVisibility="None"
                      HeadersVisibility="Column"
                      RowBackground="#FFFFFF"
                      AlternatingRowBackground="#FAFAFA"
                      Margin="0"
                      VerticalGridLinesBrush="Transparent"
                      HorizontalGridLinesBrush="#F0F0F0"
                      RowHeight="35">
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#F5F5F5"/>
                            <Setter Property="Foreground" Value="#333333"/>
                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                            <Setter Property="BorderBrush" Value="#E0E0E0"/>
                            <Setter Property="Padding" Value="8,10"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="12"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F5F5F5"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#E3F2FD"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="BorderBrush" Value="#F5F5F5"/>
                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                            <Setter Property="Padding" Value="8,0"/>
                        </Style>
                    </DataGrid.CellStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Product ID" Binding="{Binding ProductId}" Width="80" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Product Name" Binding="{Binding ProductName}" Width="150" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="80" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Price" Binding="{Binding Price, StringFormat='C'}" Width="80" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Stock" Binding="{Binding Stock}" Width="80" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" IsReadOnly="True"/>
                        <DataGridTemplateColumn Header="Actions" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="✎" 
                                            Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding ProductId}"
                                            Background="#4CAF50" 
                                            Foreground="White" 
                                            Padding="6,4" 
                                            Margin="2" 
                                            FontSize="12"
                                            Cursor="Hand"
                                            BorderThickness="0"/>

                                        <Button Content="🗑" 
                                            Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding ProductId}"
                                            Background="#F44336" 
                                            Foreground="White" 
                                            Padding="6,4" 
                                            Margin="2" 
                                            FontSize="12"
                                            Cursor="Hand"
                                            BorderThickness="0"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3" Background="#00000040" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}" Grid.ColumnSpan="2"/>

        <!-- Side Drawer -->
        <Border Grid.RowSpan="3" Background="#00000080" x:Name="DrawerOverlay" Visibility="{Binding IsDrawerOpen, Converter={StaticResource BoolToVisibility}}" Grid.ColumnSpan="2"/>

        <Border Grid.RowSpan="3" 
                HorizontalAlignment="Right" 
                Width="400" 
                Background="#FFFFFF"
                BorderBrush="#E0E0E0"
                BorderThickness="1,0,0,0"
                x:Name="SideDrawer"
                Visibility="{Binding IsDrawerOpen, Converter={StaticResource BoolToVisibility}}" 
                Grid.ColumnSpan="2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="#F5F5F5" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1" Padding="20,15">
                    <TextBlock Text="{Binding DrawerTitle}" Foreground="Black" FontSize="16" FontWeight="Bold"/>
                </Border>

                <!-- Form Content -->
                <ScrollViewer Grid.Row="1" Padding="20">
                    <StackPanel>
                        <!-- Product Name -->
                        <StackPanel>
                            <TextBlock Text="Product Name *" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15" 
                                     Text="{Binding SelectedProduct.ProductName, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Category -->
                        <StackPanel>
                            <TextBlock Text="Category *" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15"
                                      ItemsSource="{Binding Categories}"
                                      SelectedValuePath="CategoryName"
                                      DisplayMemberPath="CategoryName"
                                      SelectedValue="{Binding SelectedProduct.Category, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Unit Type -->
                        <StackPanel>
                            <TextBlock Text="Unit Type *" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15">
                                <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Pieces</System:String>
                                <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Kg</System:String>
                                <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Liter</System:String>
                                <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Box</System:String>
                                <System:String xmlns:System="clr-namespace:System;assembly=mscorlib">Pack</System:String>
                            </ComboBox>
                            <TextBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15"
                                     Text="{Binding SelectedProduct.Unit, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Price -->
                        <StackPanel>
                            <TextBlock Text="Price *" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15"
                                     Text="{Binding SelectedProduct.Price, UpdateSourceTrigger=PropertyChanged, StringFormat='F2'}"/>
                        </StackPanel>

                        <!-- Stock -->
                        <StackPanel>
                            <TextBlock Text="Stock *" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15"
                                     Text="{Binding SelectedProduct.Stock, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Low Stock Threshold -->
                        <StackPanel>
                            <TextBlock Text="Low Stock Threshold" Foreground="#333333" FontSize="12" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox BorderBrush="#E0E0E0" BorderThickness="1" Padding="10,8" FontSize="12" Margin="0,0,0,15"
                                     Text="{Binding SelectedProduct.LowStockThreshold, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Footer Buttons -->
                <Grid Grid.Row="2" Margin="20" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" 
                            Content="Cancel" 
                            Command="{Binding CancelCommand}"
                            Background="Transparent"
                            Foreground="#1976D2" 
                            BorderBrush="#1976D2"
                            BorderThickness="1"
                            Padding="10,8" 
                            FontSize="12"
                            FontWeight="Bold"
                            Margin="0,0,5,0"
                            Cursor="Hand"/>

                    <Button Grid.Column="1" 
                            Content="Save" 
                            Command="{Binding SaveItemCommand}"
                            Background="#4CAF50"
                            Foreground="White" 
                            Padding="10,8" 
                            FontSize="12"
                            FontWeight="Bold"
                            Margin="5,0,0,0"
                            Cursor="Hand"
                            BorderThickness="0"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
